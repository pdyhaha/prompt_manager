<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Prompt 管理平台</title>
    <meta name="description" content="本地 Prompt 管理平台，支持版本历史跟踪和差异对比">
    
    <!-- PWA 支持 -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Prompts">
    
    <!-- 图标 -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="apple-touch-icon" href="/icons/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192.png">
    
    <!-- 样式 -->
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 移动端菜单按钮 -->
    <button id="mobileMenuBtn" class="mobile-menu-btn" aria-label="菜单">☰</button>
    <!-- 侧边栏遮罩 -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>
    
    <div class="app-container">
        <!-- 左侧边栏 -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1 class="logo">📝 Prompt Manager</h1>
                <button id="newPromptBtn" class="btn btn-primary btn-block">
                    <span class="icon">+</span> 新建 Prompt
                </button>
            </div>
            
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="搜索 Prompt..." class="search-input">
            </div>
            
            <div class="tags-filter">
                <h3 class="section-title">标签筛选</h3>
                <div id="tagsContainer" class="tags-list">
                    <!-- 动态生成标签 -->
                </div>
            </div>
            
            <div class="prompts-list-container">
                <h3 class="section-title">Prompt 列表</h3>
                <div id="promptsList" class="prompts-list">
                    <!-- 动态生成列表 -->
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="batch-actions" id="batchActions" style="display: none;">
                    <span class="batch-count">已选择 <span id="selectedCount">0</span> 项</span>
                    <button id="batchDeleteBtn" class="btn btn-danger btn-sm">🗑️ 批量删除</button>
                    <button id="cancelBatchBtn" class="btn btn-secondary btn-sm">取消</button>
                </div>
                <button id="batchModeBtn" class="btn btn-secondary btn-sm btn-block">
                    ☑️ 批量选择
                </button>
                <button id="recycleBinBtn" class="btn btn-secondary btn-sm btn-block">
                    🗑️ 回收站
                </button>
                <div class="sidebar-footer-row">
                    <button id="exportBtn" class="btn btn-secondary btn-sm">
                        📤 导出
                    </button>
                    <button id="importBtn" class="btn btn-secondary btn-sm">
                        📥 导入
                    </button>
                </div>
                <button id="exitBtn" class="btn btn-danger btn-sm btn-block" style="margin-top: 8px;">
                    ⏻ 退出应用
                </button>
                <input type="file" id="importFile" accept=".json,.py" style="display: none;">
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 空状态 -->
            <div id="emptyState" class="empty-state">
                <div class="empty-icon">📋</div>
                <h2>欢迎使用 Prompt 管理平台</h2>
                <p>点击左侧「新建 Prompt」开始创建你的第一个 Prompt</p>
            </div>

            <!-- 编辑区 -->
            <div id="editorPanel" class="editor-panel" style="display: none;">
                <div class="editor-header">
                    <input type="text" id="promptTitle" placeholder="输入 Prompt 标题..." class="title-input">
                <div class="editor-actions">
                        <button id="aiOptimizeBtn" class="btn btn-ai" title="AI 优化提示词">
                            ✨ AI 优化
                        </button>
                        <button id="copyBtn" class="btn btn-icon" title="复制到剪贴板">
                            📋 复制
                        </button>
                        <button id="saveBtn" class="btn btn-primary">
                            💾 保存
                        </button>
                        <button id="deleteBtn" class="btn btn-danger">
                            🗑️ 删除
                        </button>
                    </div>
                </div>
                
                <div class="tags-input-container">
                    <label>标签：</label>
                    <input type="text" id="tagsInput" placeholder="输入标签，用逗号分隔..." class="tags-input">
                </div>
                
                <div class="editor-body">
                    <textarea id="promptContent" placeholder="在这里输入你的 Prompt 内容..." class="content-textarea"></textarea>
                </div>
                
                <div class="editor-footer">
                    <span id="charCount" class="char-count">0 字符</span>
                    <span id="lastSaved" class="last-saved"></span>
                </div>
            </div>
        </main>

        <!-- 右侧历史面板 -->
        <aside id="historyPanel" class="history-panel" style="display: none;">
            <div class="history-header">
                <h2>📜 版本对比</h2>
                <button id="closeHistoryBtn" class="btn btn-icon btn-sm">✕</button>
            </div>
            
            <!-- 双窗口差异对比 -->
            <div class="diff-compare-container">
                <!-- 上方窗口 - 历史版本 -->
                <div class="diff-pane diff-pane-top">
                    <div class="diff-pane-header">
                        <label>历史版本：</label>
                        <select id="diffVersionA" class="version-select">
                            <!-- 动态生成版本选项 -->
                        </select>
                    </div>
                    <div id="diffContentA" class="diff-pane-content">
                        <!-- 版本 A 内容 -->
                    </div>
                </div>
                
                <!-- 分隔线 -->
                <div class="diff-divider">
                    <span class="diff-divider-label">↕ 对比</span>
                </div>
                
                <!-- 下方窗口 - 版本 B (当前版本，固定) -->
                <div class="diff-pane diff-pane-bottom">
                    <div class="diff-pane-header">
                        <label>当前版本：</label>
                        <span id="currentVersionLabel" class="current-version-label">v1</span>
                    </div>
                    <!-- 差异快速跳转进度条 -->
                    <div class="diff-nav-bar">
                        <div class="diff-nav-label">修改:</div>
                        <div id="diffNavTrack" class="diff-nav-track">
                            <!-- 动态生成修改标记 -->
                        </div>
                        <div class="diff-nav-info">
                            <span id="diffNavCurrent">0</span>/<span id="diffNavTotal">0</span>
                            <button id="diffNavPrev" class="btn btn-icon btn-xs" title="上一处">◀</button>
                            <button id="diffNavNext" class="btn btn-icon btn-xs" title="下一处">▶</button>
                        </div>
                    </div>
                    <div id="diffContentB" class="diff-pane-content">
                        <!-- 版本 B 内容 -->
                    </div>
                </div>
            </div>
            
            <!-- 操作按钮 -->
            <div class="diff-actions">
                <button id="deleteVersionABtn" class="btn btn-danger btn-sm">
                    🗑️ 删除历史版本
                </button>
            </div>
        </aside>
    </div>

    <!-- 通知提示 -->
    <div id="toast" class="toast"></div>

    <!-- 确认对话框 -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3 id="confirmTitle">确认操作</h3>
            <p id="confirmMessage">确定要执行此操作吗？</p>
            <div class="modal-actions">
                <button id="confirmCancel" class="btn btn-secondary">取消</button>
                <button id="confirmOk" class="btn btn-danger">确定</button>
            </div>
        </div>
    </div>

    <!-- 回收站对话框 -->
    <div id="recycleBinModal" class="modal">
        <div class="modal-content modal-md">
            <div class="modal-header">
                <h3>🗑️ 回收站</h3>
                <button id="closeRecycleBinBtn" class="btn btn-icon btn-sm">✕</button>
            </div>
            <div id="recycleBinContent" class="recycle-bin-content">
                <!-- 动态生成回收站内容 -->
            </div>
            <div class="modal-footer">
                <button id="emptyRecycleBinBtn" class="btn btn-danger btn-sm">
                    🗑️ 清空回收站
                </button>
            </div>
        </div>
    </div>

    <!-- 回收站版本对比对话框 -->
    <div id="recycleDiffModal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>📋 版本对比</h3>
                <button id="closeRecycleDiffBtn" class="btn btn-icon btn-sm">✕</button>
            </div>
            <div class="recycle-diff-container">
                <div class="recycle-diff-pane">
                    <div class="diff-pane-header">
                        <label>已删除版本</label>
                    </div>
                    <div id="recycleDiffDeleted" class="diff-pane-content"></div>
                </div>
                <div class="diff-divider">
                    <span class="diff-divider-label">↕ 差异对比</span>
                </div>
                <div class="recycle-diff-pane">
                    <div class="diff-pane-header">
                        <label>对比版本：</label>
                        <select id="recycleCompareVersion" class="version-select"></select>
                    </div>
                    <div id="recycleDiffCompare" class="diff-pane-content"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="restoreFromRecycleBtn" class="btn btn-primary btn-sm">
                    ↩️ 恢复此版本
                </button>
            </div>
        </div>
    </div>

    <!-- AI 优化对话框 -->
    <div id="aiOptimizeModal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>✨ AI Prompt 优化</h3>
                <button id="closeAIOptimizeBtn" class="btn btn-icon btn-sm">✕</button>
            </div>
            <div class="ai-optimize-controls">
                <div class="model-selector">
                    <label>选择模型：</label>
                    <select id="aiModelSelect" class="version-select ai-model-select">
                        <optgroup label="通义千问 (阿里云)">
                            <option value="qwen-plus">🚀 Qwen Plus</option>
                            <option value="qwen3-max">💎 Qwen3 Max</option>
                        </optgroup>
                        <optgroup label="智谱清言 (Zhipu)">
                            <option value="glm-4.5">⚡ GLM-4.5</option>
                            <option value="glm-4.6">🌟 GLM-4.6</option>
                        </optgroup>
                        <optgroup label="Google">
                            <option value="gemini-3-pro">🌟 Gemini 3 Pro</option>
                        </optgroup>
                        <optgroup label="Anthropic">
                            <option value="claude-4.5-sonnet">🤖 Claude 4.5 Sonnet</option>
                        </optgroup>
                        <optgroup label="OpenAI">
                            <option value="gpt-5.1">🧠 GPT-5.1</option>
                            <option value="gpt-5.2">💎 GPT-5.2</option>
                        </optgroup>
                    </select>
                    <button id="runOptimizeBtn" class="btn btn-primary">
                        🚀 开始优化
                    </button>
                </div>
            </div>
            <div class="ai-model-params">
                <div class="param-group">
                    <label>Temperature: <span id="tempValue">0.7</span></label>
                    <input type="range" id="aiTemperature" min="0" max="2" step="0.1" value="0.7" class="param-slider">
                    <span class="param-hint">低=精确 / 高=创意</span>
                </div>
                <div class="param-group">
                    <label>Top P:</label>
                    <input type="number" id="aiTopP" min="0" max="1" step="0.1" value="0.9" class="param-input">
                </div>
                <div class="param-group">
                    <label>Max Tokens:</label>
                    <input type="number" id="aiMaxTokens" min="100" max="8192" step="100" value="4096" class="param-input">
                </div>
                <div class="param-group param-toggle">
                    <label>
                        <input type="checkbox" id="aiDeepThinking">
                        🧠 深度思考模式
                    </label>
                    <span class="param-hint">更慢但更深入的推理</span>
                </div>
            </div>
            <div class="ai-custom-prompt">
                <label>优化指令（可选）：</label>
                <textarea id="aiUserPrompt" class="ai-custom-prompt-input" placeholder="输入额外优化要求，例如：让语气更正式、添加更多约束条件、简化表达方式、保持英文不变..."></textarea>
            </div>
            <div class="ai-optimize-content">
                <div class="ai-content-pane">
                    <div class="ai-pane-header">📝 原始 Prompt</div>
                    <div id="aiOriginalContent" class="ai-pane-content"></div>
                </div>
                <div class="ai-arrow">→</div>
                <div class="ai-content-pane">
                    <div class="ai-pane-header">
                        ✨ 优化结果
                        <label class="diff-toggle">
                            <input type="checkbox" id="showDiffToggle" checked>
                            显示差异
                        </label>
                    </div>
                    <div id="aiOptimizedContent" class="ai-pane-content">
                        <div class="ai-placeholder">点击「开始优化」查看结果</div>
                    </div>
                </div>
            </div>
            <div id="aiLoadingIndicator" class="ai-loading" style="display: none;">
                <div class="ai-spinner"></div>
                <span>AI 正在优化中...</span>
            </div>
            <div id="aiErrorMessage" class="ai-error" style="display: none;"></div>
            <div class="modal-footer">
                <button id="cancelAIOptimizeBtn" class="btn btn-secondary">取消</button>
                <button id="saveOptimizedBtn" class="btn btn-success" disabled>
                    💾 保存优化版本
                </button>
                <button id="replaceContentBtn" class="btn btn-primary" disabled>
                    ✓ 替换内容
                </button>
            </div>
        </div>
    </div>

    <script src="diff.js"></script>
    <script src="app.js"></script>
    
    <!-- Service Worker 注册 -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('SW 注册成功:', registration.scope);
                    })
                    .catch((err) => {
                        console.log('SW 注册失败:', err);
                    });
            });
        }
    </script>
</body>
</html>
